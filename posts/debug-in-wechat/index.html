

<!DOCTYPE html>



<html amp lang="cn-zh" class="no-js">
<head>
    <title>微信调试的那些事</title>
    <meta charset="utf-8">

    <script async custom-element="amp-accordion" src="https://cdn.ampproject.org/v0/amp-accordion-0.1.js"></script><script async custom-element="amp-ad" src="https://cdn.ampproject.org/v0/amp-ad-0.1.js"></script><script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script><script async custom-element="amp-carousel" src="https://cdn.ampproject.org/v0/amp-carousel-0.1.js"></script><script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script><script async custom-element="amp-dynamic-css-classes" src="https://cdn.ampproject.org/v0/amp-dynamic-css-classes-0.1.js"></script><script async custom-element="amp-form" src="https://cdn.ampproject.org/v0/amp-form-0.1.js"></script><script async custom-element="amp-fx-flying-carpet" src="https://cdn.ampproject.org/v0/amp-fx-flying-carpet-0.1.js"></script><script async custom-element="amp-image-lightbox" src="https://cdn.ampproject.org/v0/amp-image-lightbox-0.1.js"></script><script async custom-element="amp-lightbox" src="https://cdn.ampproject.org/v0/amp-lightbox-0.1.js"></script><script async custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js"></script><script async custom-element="amp-social-share" src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js"></script><script async custom-element="amp-sticky-ad" src="https://cdn.ampproject.org/v0/amp-sticky-ad-1.0.js"></script><script async custom-element="amp-user-notification" src="https://cdn.ampproject.org/v0/amp-user-notification-0.1.js"></script>
            <script async custom-element="amp-addthis" src="https://cdn.ampproject.org/v0/amp-addthis-0.1.js"></script>
            
        

    <script async src="https://cdn.ampproject.org/v0.js"></script>

    




    <link rel="canonical" href="https://blog.liyaodong.com/posts/debug-in-wechat/">

    <link rel="icon" href="/favicon.png" type="image/png" sizes="144x144">

    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">

    

    <meta name="theme-color" content="#112233" />

    
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "晓风博客",
    "alternateName": "Xiaofeng Blog",
    "url": "https://blog.liyaodong.com"
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https://blog.liyaodong.com"
  , "sameAs": [https://www.facebook.com/lydxfdd https://www.instagram.com/vvvvanilla https://www.linkedin.com/in/yaodong-li-8223a385/ https://twitter.com/xiaofengdong]
  
  
  
}
</script>


























<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https://blog.liyaodong.com",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https://blog.liyaodong.com/posts/",
          "name": "posts"
        }
    },{
        "@type": "ListItem",
        "position": 4,
        "item": {
          "@id": "https://blog.liyaodong.com/posts/debug-in-wechat/",
          "name": "debug-in-wechat"
        }
    }]
}
</script>





    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <style amp-custom>
        .chroma{background-color:#eeeedd}.chroma .err{color:#a61717;background-color:#e3d2d2}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block}.chroma .hl{display:block;width:100%;background-color:#ffffcc}.chroma .lnt{margin-right:0.4em;padding:0 0.4em 0 0.4em}.chroma .ln{margin-right:0.4em;padding:0 0.4em 0 0.4em}.chroma .k{color:#8b008b;font-weight:bold}.chroma .kc{color:#8b008b;font-weight:bold}.chroma .kd{color:#8b008b;font-weight:bold}.chroma .kn{color:#8b008b;font-weight:bold}.chroma .kp{color:#8b008b;font-weight:bold}.chroma .kr{color:#8b008b;font-weight:bold}.chroma .kt{color:#00688b;font-weight:bold}.chroma .na{color:#658b00}.chroma .nb{color:#658b00}.chroma .nc{color:#008b45;font-weight:bold}.chroma .no{color:#00688b}.chroma .nd{color:#707a7c}.chroma .ne{color:#008b45;font-weight:bold}.chroma .nf{color:#008b45}.chroma .nn{color:#008b45;text-decoration:underline}.chroma .nt{color:#8b008b;font-weight:bold}.chroma .nv{color:#00688b}.chroma .s{color:#cd5555}.chroma .sa{color:#cd5555}.chroma .sb{color:#cd5555}.chroma .sc{color:#cd5555}.chroma .dl{color:#cd5555}.chroma .sd{color:#cd5555}.chroma .s2{color:#cd5555}.chroma .se{color:#cd5555}.chroma .sh{color:#1c7e71;font-style:italic}.chroma .si{color:#cd5555}.chroma .sx{color:#cb6c20}.chroma .sr{color:#1c7e71}.chroma .s1{color:#cd5555}.chroma .ss{color:#cd5555}.chroma .m{color:#b452cd}.chroma .mb{color:#b452cd}.chroma .mf{color:#b452cd}.chroma .mh{color:#b452cd}.chroma .mi{color:#b452cd}.chroma .il{color:#b452cd}.chroma .mo{color:#b452cd}.chroma .ow{color:#8b008b}.chroma .c{color:#228b22}.chroma .ch{color:#228b22}.chroma .cm{color:#228b22}.chroma .c1{color:#228b22}.chroma .cs{color:#8b008b;font-weight:bold}.chroma .cp{color:#1e889b}.chroma .cpf{color:#1e889b}.chroma .gd{color:#aa0000}.chroma .ge{font-style:italic}.chroma .gr{color:#aa0000}.chroma .gh{color:#000080;font-weight:bold}.chroma .gi{color:#00aa00}.chroma .go{color:#888888}.chroma .gp{color:#555555}.chroma .gs{font-weight:bold}.chroma .gu{color:#800080;font-weight:bold}.chroma .gt{color:#aa0000}.chroma .gl{text-decoration:underline}.chroma .w{color:#bbbbbb}body{background-color:#f9f8f0;color:#222;font-family:"Avenir Next", "Segoe UI", "Helvetica Neue", Arial, "PingFang SC", "Heiti SC", "Microsoft YaHei UI", "Microsoft YaHei", "Source Han Sans", sans-serif}.tac{text-align:center}a{color:#222;text-decoration:none}.container{max-width:960px;margin-left:auto;margin-right:auto;padding:15px}.container img,.container amp-img{max-width:100%}.site-header{text-align:center;margin-top:40px;font-family:"Songti SC"}.site-title{margin:0;display:inline-block;vertical-align:middle}.site-subtitle{margin:5px;font-size:14px}.site-header--float{font-family:"Songti SC";padding:15px 30px;background:#fff;border-bottom:1px solid #dcdcdc}.site-header--float a{display:flex;align-items:center}.site-title--float{font-size:20px;margin:0px;margin-right:20px}.site-subtitle--float{font-size:12px;margin:0px}.site-footer{padding:10px;margin:20px;text-align:center}.article-item-title{font-size:24px;font-weight:bold;display:inline-block;vertical-align:middle;font-family:"Songti SC";margin:0}.article-item-title:hover{text-decoration:underline}.article-item-date{font-size:12px;display:block;color:#555}.article-item-summary{margin-top:20px;color:#555}.article-item-link{color:#222;text-decoration:none;margin:30px 0 5px}.article-item{max-width:700px;padding-bottom:40px;margin:0 auto 40px auto}.article-item:not(:last-of-type){border-bottom:1px solid #efefef}.article-item amp-img{margin-bottom:20px}.post-title{text-align:center;font-family:"Songti SC";font-size:32px;margin-bottom:5px}.single{line-height:1.625;color:#4a4a4a;max-width:700px}.single amp-img{margin:15px auto;text-align:center}.single code{color:#AA8D5B;font-size:14px;font-weight:bold;margin:5px}.single pre>code{font-weight:600;margin:0}.single div.highlight{box-shadow:0 3px 3px 1px #d2c7b5}.single .chroma{background-color:transparent}.single a{text-decoration:underline}.single a:hover{color:#000}.single-content{margin-bottom:20px}.pagination{display:flex;justify-content:center;margin:20px 0;padding:0}.pagination .page-item{list-style-type:none;font-size:16px;margin:0 5px}.pagination .page-item.active{font-weight:bold}

    </style>


</head>

<body>



<header class="site-header--float">
    <a href="https://blog.liyaodong.com">
        <h1 class="site-title--float">
            晓风博客
        </h1>
        <h2 class="site-subtitle--float">
            一片荒芜的地方
        </h2>
    </a>
</header>


<section class="single container">
    <h1 class="post-title">微信调试的那些事</h1>
    <div class="tac">
        <time>2015年7月6日</time>
    </div>

    <article class="single-content">
        <amp-img
    src="https://image.liyaodong.com/uploads/2015/0706/Coding_Laboratory.gif"
    alt="Coding Laboratory "
    
    
    
    
    
    width="800"
    height="600"
    layout="responsive"
    on="tap: 189 "
    role="button"
    tabindex="0"
>
</amp-img>

<amp-image-lightbox
    id="189"
    layout="nodisplay"
>
</amp-image-lightbox>


<p>微信内调试这件头疼的事情终于有一些靠谱的解决办法了。</p>

<p>最开始，我是用 <code>UA</code> 来调试的，当然只能调试一些你自己针对微信写的东西，比如针对微信的分享提示之类的。自从 <a href="http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html">微信JS-SDK</a> 发布后很多时候都有点无能为力的感觉。因为不好调试的原因经常和微信大干到半夜。为了以后不再大干到半夜 (<em>≧∀≦</em>) 总结经验给自己，也给需要的人。</p>

<p>在开始总结之前先说<strong>重要</strong>的，<a href="http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html">微信文档</a>看三遍，<a href="http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html">微信文档</a>看三遍，<a href="http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html">微信文档</a>看三遍。</p>

<h3 id="如何区分微信浏览器">如何区分微信浏览器？</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">isWechat</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="sr">/micromessenger/i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h3 id="如何在桌面浏览器中模拟微信">如何在桌面浏览器中模拟微信？</h3>

<p>参考我之前写的文章 <a href="http://liyaodong.com/2015/02/27/%E4%BD%BF%E7%94%A8Chrome%E6%A8%A1%E6%8B%9F%E5%BE%AE%E4%BF%A1%E6%B5%8F%E8%A7%88%E5%99%A8/">使用Chrome模拟微信浏览器</a></p>

<h3 id="如何调试微信js-sdk">如何调试微信JS-SDK？</h3>

<h4 id="1-通过官方的debug-参数">1. 通过官方的debug 参数</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">wx</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span>
    <span class="nx">debug</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
</span><span class="c1"></span><span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div>
<h4 id="2-通过-host-文件替换域名-本地代理调试">2. 通过 <code>host</code> 文件替换域名，本地代理调试</h4>

<p>微信是有 <code>JS接口安全域名</code> 限制的，所以想要本地调试最重要的是解决这个问题。具体在 <strong>右上角公众号名称</strong>-<strong>公众号设置</strong>-<strong>功能设置</strong>里面。</p>

<p>想要把域名映射到本地显然是改 <code>host</code> 文件方便一些，因为你不太可能把线上的域名改成本地，虽然有三个可以改。</p>

<p>Mac 下修改<code>host</code> <code>sudo vi /etc/hosts</code></p>

<p>改完 <code>host</code> 之后你还需要做代理。因为你的手机并没有改 <code>host</code> ，所以你需要在手机上设置电脑为代理。然后手机通过代理访问走 <code>host</code> 映射到本地。这件事情可以用 <a href="http://goddyzhao.me/nproxy/">NProxy</a> 来做。当然这是 Mac 下的解决方案，如果你是 <code>Win</code> 自然是功能强大的 <a href="http://www.telerik.com/fiddler">fiddler</a> 来做这件事情比较好（虽然我也没用过）。</p>

<p><code>NProxy</code> 安装并启动后，在手机上设置代理。IOS 下是在 wifi 右边的感叹号，最底下输入。通过这两部就可以本地调试微信 JS 了。</p>

<h3 id="服务器端的微信接口">服务器端的微信接口？</h3>

<p>微信有一个测试号专门用来调试、解决这些问题。测试号相当于一个临时的公众号，把程序调试开发完毕后再换成你真正的公众号配置。 <a href="http://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login">微信测试号平台地址</a></p>

<p>这种测试方法如果想测试本地的应用有个问题就是外网怎么访问本地应用，类似于花生壳的意思，不过推荐使用 <a href="https://ngrok.com/">ngrok</a> 这款牛逼哄哄的东西。方便简单，支持 <code>https</code>，就是速度没有改<code>host</code>的方法快。</p>

<p>到此为止我们至少有两套方案可以测试，改 <code>host</code> 的方法不走外网，速度快。<code>ngrok</code> 配合官方的工具功能强大但速度有时候很慢。</p>

<h3 id="一些问题-ruby-on-rails用户">一些问题（Ruby on Rails用户）</h3>

<p>我是 <code>Rails</code> 用户，本地 <code>host</code> + 代理还是要在域名后跟端口号。而 <code>Mac</code> 下 <code>1024</code> 以下的端口都需要 <code>root</code> 权限。即便你可以 <code>root</code> 运行也会发现有很多配置有问题了，比如 <code>PG</code>。</p>

<p>对于 <code>rbenv</code> 用户来说推荐使用 <a href="https://github.com/dcarley/rbenv-sudo">rbenv-sudo</a> 来解决需要使用 <code>root</code> 权限来运行 <code>Ruby</code> 的情况。安装好 <code>rbenv-root</code> 后&hellip; 对于我这种懒人&hellip; <code>~/.zshrc</code> <code>sudors () { rbenv sudo rails s -p 80 -b 0.0.0.0 }</code></p>

<p>针对 <code>PG</code> 报错你需要编辑 <code>config.yml</code> 给数据库指定用户名。</p>

<p>当 <code>root</code> 运行过后普通权限下 <code>rails</code> 启动报错，很可能是缓存文件是由 <code>root</code> 用户创建而普通用户无法读取导致的。用 <code>root</code> 权限删除缓存即可<code>sudo rm -rf ./tmp/cache</code> 。</p>

<p>如果 <code>Rails</code> 已经启动本地可以访问但局域网其他设备无法访问，你需要指定运行的 IP 为 <code>0.0.0.0</code> <code>rails s -p 0.0.0.0</code></p>

<h3 id="说了那么多-说好的调试呢">说了那么多，说好的调试呢？</h3>

<p>微信内没有 <code>console</code> 没有 <code>Devtools</code>，样式错乱，JS 报错根本不知道有木有！</p>

<p>如果 Chrome 的开发者工具可以运行在微信里就好了，然而&hellip; 这个东西确实有！</p>

<p><a href="http://people.apache.org/~pmuellr/weinre-docs/latest/">weinre</a> <strong>WE</strong>b <strong>IN</strong>spector <strong>RE</strong>mote 一款在 Chrome 里调试 Android、IOS 网页的东西，不管是哪家的浏览器，还是 <code>webview</code> ，通吃。</p>

<p><code>npm -g install weinre</code></p>

<p><code>weinre --boundHost 0.0.0.0</code></p>

<p>然后在你的项目里引入 <code>weinre</code> 的一个 JS 文件就可以用了。需要注意的是引入的时候地址应该是 <code>http://192.168.1.*/xxx.js</code> 这样的局域网可访的地址。那么问题来了，局域网 IP 怎么查&hellip; Mac 下最快的方法，按住 option 点 Wifi 图标。（感谢 <a href="http://macshuo.com/">MacTalk</a>）</p>

<h3 id="还有没有更方便的东西">还有没有更方便的东西？</h3>

<p>当你想用手机访问电脑本地服务器的时候你会怎么做？</p>

<p>看今天的局域网 IP 多少，然后从 QQ 或者微信里拼好要访问的链接地址，发过去，如此反复。</p>

<p>不知道多少喝咖啡陪女朋友的时间都没了。</p>

<p>Geek 就是要动手解决痛点，URL2QR 你需要这么一个插件。</p>

<p><a href="https://chrome.google.com/webstore/detail/url2qr/pmlpmeejppihnemepiadkmnghmbclhpg">Chrome 商店安装</a></p>

<p><a href="http://liyaodong.com/2015/01/30/%E6%96%B0%E7%9A%84Chrome%E6%8F%92%E4%BB%B6%E3%80%8CURL2QR%E3%80%8D/">这个屌插件是怎么写的？</a></p>

<p>说了这么多，以后应该或许再也不用担心微信调试了吧。但愿如此，细心认真扩展思路还是排除 Bug 最快的方法。</p>

<p>The End .</p>

<p>头图来自 <a href="https://dribbble.com/shots/1727546-Coding-Laboratory?list=searches&amp;tag=code&amp;offset=65">dribbble@Valentin Kirilov</a> 侵删</p>

<blockquote class="blockquote-center">There is only one God，and his name is Death. And there is only one thing we say to Death:“Not today.”</blockquote>
    </article>

    <amp-addthis
        width="320"
        height="92"
        layout="responsive"

        data-pub-id="ra-5c09c9760bf7e3b3"
        data-widget-id="861l"></amp-addthis>

</section>

<footer class="site-footer">
    Powered by <a href="https://www.gnu.org/software/emacs/">Emacs</a> and <a href="https://gohugo.io/">Hugo</a> with &#10084;.
</footer>



<amp-analytics type="googleanalytics">
    <script type="application/json">
        {
            "vars": {
                "account": "UA-30027709-1"
            },
            "triggers": {"trackPageview":{"on":"visible","request":"pageview"}}
        }
    </script>
</amp-analytics>

</body>
</html>

